#! /usr/bin/env node

var cmdLn = require('cmd-ln')
var db = require('../lib/db')
var browserifiability = require('../lib/browserifiability')

cmdLn(function(moduleName){

  db(function(err, db){
    var Modules = db.collection('modules')
    var TestSummary = db.collection('test_summary')
    
    Modules.findOne({_id: moduleName}, function(err, module){
      if (err) return callback(err)
      TestSummary.find().toArray(function(err, testSummary){
        if (err) return callback(err)

        browserifiability(module, testSummary, function(err, value){
          if (err) console.error(err.message)
          else console.log(value)
          db.close()
        })
      })
    })
  })

})
