#! /usr/bin/env node

var db = require('../lib/db')
var pick10 = require('../lib/pick_10')

db(function(err, db){
  if (err) console.error(err.message)

  var modules = db.collection('modules')
  var criteria = {
    'testResults.browserify.test.passed': true
  }
  modules.find(criteria, {name: true})
    .toArray(function(err, results){
      if (err) console.error(err.message)
      results = pick10(results)
      var modNames = results.map(function(m){
        return m.name
      })
      modules.find({name: {$in: modNames}})
        .toArray(function(err, mods){
        if (err) console.error(err.message)
        
        mods.forEach(function(module){
          console.log(module.name)
          console.log('  ', module.testResults.coreDeps)
        })
        db.close()
      })
      
    })
})